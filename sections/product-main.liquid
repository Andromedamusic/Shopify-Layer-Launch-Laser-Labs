{%- comment -%}
  Main Product Section
  Includes personalization form, bulk order CTA, and product details
{%- endcomment -%}

{% render 'product-schema' %}
{% render 'breadcrumb-schema' %}

<div class="product-main page-width section-{{ section.id }}-padding">
  <div class="product-main__grid">
    {%- comment -%} Product Gallery {%- endcomment -%}
    <div class="product-main__gallery">
      <div class="product-gallery">
        {% if product.images.size > 0 %}
          <div class="product-gallery__main" data-zoom-trigger>
            {{ product.featured_image | image_url: width: 800 | image_tag:
              loading: 'eager',
              class: 'product-gallery__main-image',
              id: 'product-main-image',
              alt: product.featured_image.alt | default: product.title
            }}
            <div class="product-gallery__zoom-hint">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
                <path d="M11 8v6M8 11h6"/>
              </svg>
              <span>Click to zoom</span>
            </div>
          </div>
          {% if product.images.size > 1 %}
            <div class="product-gallery__thumbnails">
              {% for image in product.images %}
                <button
                  class="product-gallery__thumbnail {% if forloop.first %}active{% endif %}"
                  data-image-url="{{ image | image_url: width: 800 }}"
                  data-index="{{ forloop.index0 }}"
                >
                  {{ image | image_url: width: 100 | image_tag:
                    loading: 'lazy',
                    alt: image.alt | default: product.title
                  }}
                </button>
              {% endfor %}
            </div>
          {% endif %}
        {% else %}
          <div class="product-gallery__placeholder">
            {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
          </div>
        {% endif %}
      </div>
    </div>

    {%- comment -%} Product Info {%- endcomment -%}
    <div class="product-main__info">
      {%- comment -%} Breadcrumb {%- endcomment -%}
      <nav class="product-breadcrumb">
        <a href="/">Home</a>
        <span>/</span>
        {% if collection %}
          <a href="{{ collection.url }}">{{ collection.title }}</a>
          <span>/</span>
        {% endif %}
        <span>{{ product.title }}</span>
      </nav>

      <h1 class="product-main__title h2">{{ product.title }}</h1>

      {%- comment -%} Price {%- endcomment -%}
      <div class="product-main__price">
        {% if product.compare_at_price > product.price %}
          <span class="product-main__price-compare">{{ product.compare_at_price | money }}</span>
        {% endif %}
        <span class="product-main__price-current">{{ product.price | money }}</span>
        {% if section.settings.price_includes_personalization %}
          <span class="product-main__price-note">Personalization included</span>
        {% endif %}
      </div>

      {%- comment -%} Product Form {%- endcomment -%}
      {% form 'product', product, class: 'product-form', data-product-form: '' %}
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

        {%- comment -%} Variant Selector (if multiple variants) {%- endcomment -%}
        {% if product.variants.size > 1 %}
          <div class="product-form__variants">
            {% for option in product.options_with_values %}
              <div class="product-form__option">
                <label for="option-{{ option.name | handle }}">{{ option.name }}</label>
                <select id="option-{{ option.name | handle }}" name="options[{{ option.name }}]" class="product-form__select">
                  {% for value in option.values %}
                    <option value="{{ value }}" {% if option.selected_value == value %}selected{% endif %}>
                      {{ value }}
                    </option>
                  {% endfor %}
                </select>
              </div>
            {% endfor %}
          </div>
        {% endif %}

        {%- comment -%} Personalization Fields {%- endcomment -%}
        {% if section.settings.enable_personalization %}
          {% render 'product-personalization-form', product: product %}
        {% endif %}

        {%- comment -%} Quantity & Add to Cart {%- endcomment -%}
        <div class="product-form__actions">
          <div class="product-form__quantity">
            <label for="quantity">Quantity</label>
            <div class="quantity-selector">
              <button type="button" class="quantity-btn quantity-btn--minus" aria-label="Decrease quantity">âˆ’</button>
              <input type="number" id="quantity" name="quantity" value="1" min="1" max="99">
              <button type="button" class="quantity-btn quantity-btn--plus" aria-label="Increase quantity">+</button>
            </div>
          </div>

          <button type="submit" class="product-form__submit button button--primary" {% unless product.available %}disabled{% endunless %}>
            {% if product.available %}
              Add to Cart
            {% else %}
              Sold Out
            {% endif %}
          </button>
        </div>
      {% endform %}

      {%- comment -%} Bulk Order CTA {%- endcomment -%}
      {% if section.settings.show_bulk_cta %}
        {% render 'bulk-order-cta', product: product %}
      {% endif %}

      {%- comment -%} Trust Badges {%- endcomment -%}
      <div class="product-main__trust">
        <div class="trust-badge">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="1" y="3" width="15" height="13" rx="2" ry="2"/>
            <path d="M16 8H20C20.5304 8 21.0391 8.21071 21.4142 8.58579C21.7893 8.96086 22 9.46957 22 10V18C22 18.5304 21.7893 19.0391 21.4142 19.4142C21.0391 19.7893 20.5304 20 20 20H4C3.46957 20 2.96086 19.7893 2.58579 19.4142C2.21071 19.0391 2 18.5304 2 18V16"/>
            <circle cx="12" cy="14" r="2"/>
          </svg>
          <span>Secure Checkout</span>
        </div>
        <div class="trust-badge">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z"/>
            <path d="M12 6V12L16 14"/>
          </svg>
          <span>{{ section.settings.shipping_estimate | default: 'Ships in 5-7 days' }}</span>
        </div>
        <div class="trust-badge">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20.84 4.61C20.3292 4.099 19.7228 3.69364 19.0554 3.41708C18.3879 3.14052 17.6725 2.99817 16.95 2.99817C16.2275 2.99817 15.5121 3.14052 14.8446 3.41708C14.1772 3.69364 13.5708 4.099 13.06 4.61L12 5.67L10.94 4.61C9.9083 3.57831 8.50903 2.99871 7.05 2.99871C5.59096 2.99871 4.19169 3.57831 3.16 4.61C2.1283 5.64169 1.54871 7.04097 1.54871 8.5C1.54871 9.95903 2.1283 11.3583 3.16 12.39L12 21.23L20.84 12.39C21.351 11.8792 21.7563 11.2728 22.0329 10.6054C22.3095 9.93789 22.4518 9.22248 22.4518 8.5C22.4518 7.77752 22.3095 7.0621 22.0329 6.39464C21.7563 5.72718 21.351 5.12075 20.84 4.61Z"/>
          </svg>
          <span>Satisfaction Guaranteed</span>
        </div>
      </div>

      {%- comment -%} Social Sharing {%- endcomment -%}
      {% if section.settings.show_social_sharing %}
        <div class="product-main__social-sharing">
          <span class="social-sharing__label">Share:</span>
          <div class="social-sharing__buttons">
            <a href="https://www.facebook.com/sharer/sharer.php?u={{ shop.url }}{{ product.url }}"
               target="_blank"
               rel="noopener noreferrer"
               class="social-sharing__btn social-sharing__btn--facebook"
               aria-label="Share on Facebook">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
              </svg>
            </a>
            <a href="https://twitter.com/intent/tweet?text={{ product.title | url_encode }}&url={{ shop.url }}{{ product.url }}"
               target="_blank"
               rel="noopener noreferrer"
               class="social-sharing__btn social-sharing__btn--twitter"
               aria-label="Share on Twitter">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
              </svg>
            </a>
            <a href="https://pinterest.com/pin/create/button/?url={{ shop.url }}{{ product.url }}&media={{ product.featured_image | image_url: width: 800 }}&description={{ product.title | url_encode }}"
               target="_blank"
               rel="noopener noreferrer"
               class="social-sharing__btn social-sharing__btn--pinterest"
               aria-label="Share on Pinterest">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0C5.373 0 0 5.372 0 12c0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738.098.119.112.224.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.631-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24 12 24c6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12z"/>
              </svg>
            </a>
            <button class="social-sharing__btn social-sharing__btn--copy"
                    data-copy-url="{{ shop.url }}{{ product.url }}"
                    aria-label="Copy link">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
              </svg>
              <span class="copy-tooltip">Copied!</span>
            </button>
          </div>
        </div>
      {% endif %}

      {%- comment -%} Product Details Accordion {%- endcomment -%}
      <div class="product-main__details">
        <details class="product-details" open>
          <summary>
            <span>Description</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </summary>
          <div class="product-details__content">
            {{ product.description }}
          </div>
        </details>

        {% if section.settings.materials_info != blank %}
          <details class="product-details">
            <summary>
              <span>Materials & Specs</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </summary>
            <div class="product-details__content">
              {{ section.settings.materials_info }}
            </div>
          </details>
        {% endif %}

        {% if section.settings.care_info != blank %}
          <details class="product-details">
            <summary>
              <span>Care Instructions</span>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </summary>
            <div class="product-details__content">
              {{ section.settings.care_info }}
            </div>
          </details>
        {% endif %}

        <details class="product-details">
          <summary>
            <span>Shipping & Returns</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </summary>
          <div class="product-details__content">
            <p><strong>Processing Time:</strong> {{ section.settings.processing_time | default: '3-5 business days' }}</p>
            <p><strong>Shipping:</strong> Free standard shipping on orders over $75. Express options available at checkout.</p>
            <p><strong>Returns:</strong> Due to the personalized nature of our products, we cannot accept returns unless there is a defect. <a href="/policies/refund-policy">View full policy</a></p>
          </div>
        </details>
      </div>
    </div>
  </div>

  {%- comment -%} Product Reviews Section {%- endcomment -%}
  {% if section.settings.show_reviews %}
    <div class="product-reviews">
      <div class="product-reviews__header">
        <h2 class="product-reviews__title">Customer Reviews</h2>
        <div class="product-reviews__summary">
          <div class="product-reviews__stars">
            {% for i in (1..5) %}
              <svg width="24" height="24" viewBox="0 0 24 24" fill="#c9a227" stroke="#c9a227" stroke-width="1">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
              </svg>
            {% endfor %}
          </div>
          <span class="product-reviews__rating">5.0 out of 5</span>
          <span class="product-reviews__count">Based on customer satisfaction</span>
        </div>
      </div>

      <div class="product-reviews__highlights">
        <div class="review-highlight">
          <div class="review-highlight__icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#c9a227" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
          </div>
          <div class="review-highlight__content">
            <span class="review-highlight__stat">100%</span>
            <span class="review-highlight__label">Quality Satisfaction</span>
          </div>
        </div>
        <div class="review-highlight">
          <div class="review-highlight__icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#c9a227" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
          </div>
          <div class="review-highlight__content">
            <span class="review-highlight__stat">Fast</span>
            <span class="review-highlight__label">Production & Shipping</span>
          </div>
        </div>
        <div class="review-highlight">
          <div class="review-highlight__icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#c9a227" stroke-width="2">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
          </div>
          <div class="review-highlight__content">
            <span class="review-highlight__stat">Loved</span>
            <span class="review-highlight__label">Gift Recipients</span>
          </div>
        </div>
      </div>

      <div class="product-reviews__testimonials">
        <div class="review-card">
          <div class="review-card__stars">
            {% for i in (1..5) %}
              <svg width="16" height="16" viewBox="0 0 24 24" fill="#c9a227" stroke="#c9a227" stroke-width="1">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
              </svg>
            {% endfor %}
          </div>
          <p class="review-card__text">"Hunter was very responsive, professional and extremely quick to fill an order. The slate coasters were beautiful!"</p>
          <div class="review-card__author">
            <span class="review-card__name">Janet</span>
            <span class="review-card__verified">via Facebook</span>
          </div>
        </div>
        <div class="review-card">
          <div class="review-card__stars">
            {% for i in (1..5) %}
              <svg width="16" height="16" viewBox="0 0 24 24" fill="#c9a227" stroke="#c9a227" stroke-width="1">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
              </svg>
            {% endfor %}
          </div>
          <p class="review-card__text">"Beautiful coasters. Fast communication and shipping. Love them!"</p>
          <div class="review-card__author">
            <span class="review-card__name">Lynn</span>
            <span class="review-card__verified">via Facebook</span>
          </div>
        </div>
        <div class="review-card">
          <div class="review-card__stars">
            {% for i in (1..5) %}
              <svg width="16" height="16" viewBox="0 0 24 24" fill="#c9a227" stroke="#c9a227" stroke-width="1">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
              </svg>
            {% endfor %}
          </div>
          <p class="review-card__text">"Excellent quality!! Very professional and delivered the product!!! VERY pleased"</p>
          <div class="review-card__author">
            <span class="review-card__name">Heidi</span>
            <span class="review-card__verified">via Facebook</span>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
</div>

{%- comment -%} Sticky Mobile Add to Cart {%- endcomment -%}
<div class="product-sticky-cart" id="product-sticky-cart">
  <div class="product-sticky-cart__inner page-width">
    <div class="product-sticky-cart__info">
      <span class="product-sticky-cart__title">{{ product.title | truncate: 30 }}</span>
      <span class="product-sticky-cart__price">{{ product.price | money }}</span>
    </div>
    <button type="button" class="product-sticky-cart__btn button button--primary" data-sticky-add-to-cart {% unless product.available %}disabled{% endunless %}>
      {% if product.available %}Add to Cart{% else %}Sold Out{% endif %}
    </button>
  </div>
</div>

{%- comment -%} Image Zoom Modal {%- endcomment -%}
<div class="product-zoom-modal" id="product-zoom-modal">
  <button class="product-zoom-modal__close" aria-label="Close zoom">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="18" y1="6" x2="6" y2="18"/>
      <line x1="6" y1="6" x2="18" y2="18"/>
    </svg>
  </button>
  <div class="product-zoom-modal__content">
    <img src="" alt="" class="product-zoom-modal__image" id="zoom-image">
  </div>
  <div class="product-zoom-modal__nav">
    <button class="product-zoom-modal__nav-btn product-zoom-modal__prev" aria-label="Previous image">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"/>
      </svg>
    </button>
    <button class="product-zoom-modal__nav-btn product-zoom-modal__next" aria-label="Next image">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9 18 15 12 9 6"/>
      </svg>
    </button>
  </div>
</div>

<style>
  .product-main {
    padding: 40px 0 80px;
  }
  .product-main__grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    align-items: start;
  }
  @media (max-width: 989px) {
    .product-main__grid {
      grid-template-columns: 1fr;
      gap: 2rem;
    }
  }

  /* Gallery */
  .product-gallery__main {
    margin-bottom: 1rem;
    border-radius: 8px;
    overflow: hidden;
    background: #f8f8f8;
  }
  .product-gallery__main-image {
    width: 100%;
    height: auto;
    display: block;
  }
  .product-gallery__thumbnails {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
  }
  .product-gallery__thumbnail {
    flex-shrink: 0;
    width: 70px;
    height: 70px;
    padding: 0;
    border: 2px solid transparent;
    border-radius: 6px;
    overflow: hidden;
    cursor: pointer;
    background: #f8f8f8;
  }
  .product-gallery__thumbnail.active {
    border-color: #1a1a1a;
  }
  .product-gallery__thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Breadcrumb */
  .product-breadcrumb {
    font-size: 0.875rem;
    margin-bottom: 1rem;
    color: #595959 !important;
  }
  .product-breadcrumb a {
    color: #595959 !important;
    text-decoration: none;
  }
  .product-breadcrumb a:hover {
    color: #1a1a1a;
  }
  .product-breadcrumb span {
    margin: 0 0.5rem;
  }

  /* Title & Price */
  .product-main__title {
    margin-bottom: 0.75rem;
  }
  .product-main__price {
    display: flex;
    align-items: baseline;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
  }
  .product-main__price-current {
    font-size: 1.5rem;
    font-weight: 600;
  }
  .product-main__price-compare {
    font-size: 1.1rem;
    color: #6b6b6b !important;
    text-decoration: line-through;
  }
  .product-main__price-note {
    font-size: 0.875rem;
    color: #2e7d32;
  }

  /* Form */
  .product-form__variants {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  .product-form__option label {
    display: block;
    font-weight: 500;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }
  .product-form__select {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
  }
  .product-form__actions {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
  }
  .product-form__quantity {
    flex-shrink: 0;
  }
  .product-form__quantity label {
    display: block;
    font-weight: 500;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }
  .quantity-selector {
    display: flex;
    align-items: center;
    border: 1px solid #ddd;
    border-radius: 6px;
    overflow: hidden;
  }
  .quantity-btn {
    width: 40px;
    height: 44px;
    border: none;
    background: #f8f8f8;
    cursor: pointer;
    font-size: 1.25rem;
    transition: background 0.2s;
  }
  .quantity-btn:hover {
    background: #eee;
  }
  .quantity-selector input {
    width: 50px;
    height: 44px;
    border: none;
    text-align: center;
    font-size: 1rem;
    -moz-appearance: textfield;
  }
  .quantity-selector input::-webkit-outer-spin-button,
  .quantity-selector input::-webkit-inner-spin-button {
    -webkit-appearance: none;
  }
  .product-form__submit {
    flex: 1;
    padding: 1rem;
    font-size: 1rem;
    margin-top: auto;
  }

  /* Trust Badges */
  .product-main__trust {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin: 1.5rem 0;
    padding: 1rem 0;
    border-top: 1px solid #eee;
    border-bottom: 1px solid #eee;
  }
  .trust-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: #4a4a4a !important;
  }
  .trust-badge svg {
    color: #2e7d32;
  }

  /* Details Accordion */
  .product-main__details {
    margin-top: 1.5rem;
  }
  .product-details {
    border-bottom: 1px solid #eee;
  }
  .product-details summary {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    cursor: pointer;
    list-style: none;
    font-weight: 500;
  }
  .product-details summary::-webkit-details-marker {
    display: none;
  }
  .product-details summary svg {
    transition: transform 0.2s;
  }
  .product-details[open] summary svg {
    transform: rotate(180deg);
  }
  .product-details__content {
    padding: 0 0 1rem 0;
    color: #3d3d3d !important;
    line-height: 1.7;
    font-size: 0.95rem;
  }
  .product-details__content p {
    margin: 0 0 0.75rem 0;
  }
  .product-details__content a {
    color: #1a1a1a;
  }

  /* Social Sharing */
  .product-main__social-sharing {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin: 1.5rem 0;
  }
  .social-sharing__label {
    font-size: 0.9rem;
    color: #4a4a4a !important;
    font-weight: 500;
  }
  .social-sharing__buttons {
    display: flex;
    gap: 0.5rem;
  }
  .social-sharing__btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 1px solid #ccc;
    background: white;
    color: #4a4a4a !important;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    position: relative;
  }
  .social-sharing__btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
  .social-sharing__btn--facebook:hover { background: #1877f2; color: white; border-color: #1877f2; }
  .social-sharing__btn--twitter:hover { background: #1da1f2; color: white; border-color: #1da1f2; }
  .social-sharing__btn--pinterest:hover { background: #bd081c; color: white; border-color: #bd081c; }
  .social-sharing__btn--copy:hover { background: #1a1a1a; color: white; border-color: #1a1a1a; }
  .copy-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: #1a1a1a;
    color: white;
    padding: 0.4rem 0.75rem;
    border-radius: 4px;
    font-size: 0.75rem;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
    margin-bottom: 0.5rem;
  }
  .social-sharing__btn--copy.copied .copy-tooltip {
    opacity: 1;
  }

  /* Gallery Zoom */
  .product-gallery__main {
    position: relative;
    cursor: zoom-in;
  }
  .product-gallery__zoom-hint {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(255,255,255,0.95);
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.85rem;
    color: #333;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
  }
  .product-gallery__main:hover .product-gallery__zoom-hint {
    opacity: 1;
  }

  /* Zoom Modal */
  .product-zoom-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.95);
    z-index: 9999;
    display: none;
    align-items: center;
    justify-content: center;
  }
  .product-zoom-modal.active {
    display: flex;
  }
  .product-zoom-modal__close {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    background: rgba(0,0,0,0.6);
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    color: white;
    cursor: pointer;
    padding: 0.5rem;
    z-index: 10;
    transition: transform 0.2s, background 0.2s, border-color 0.2s;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .product-zoom-modal__close:hover {
    transform: scale(1.1);
    background: rgba(0,0,0,0.8);
    border-color: rgba(255,255,255,0.5);
  }
  .product-zoom-modal__content {
    max-width: 90%;
    max-height: 90%;
    overflow: auto;
  }
  .product-zoom-modal__image {
    max-width: 100%;
    max-height: 90vh;
    object-fit: contain;
  }
  .product-zoom-modal__nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0,0,0,0.6);
    border: 2px solid rgba(255,255,255,0.3);
    color: white;
    cursor: pointer;
    padding: 1rem;
    border-radius: 50%;
    transition: background 0.2s, border-color 0.2s;
  }
  .product-zoom-modal__nav-btn:hover {
    background: rgba(0,0,0,0.8);
    border-color: rgba(255,255,255,0.5);
  }
  .product-zoom-modal__prev { left: 1.5rem; }
  .product-zoom-modal__next { right: 1.5rem; }

  /* Product Reviews */
  .product-reviews {
    margin-top: 4rem;
    padding-top: 4rem;
    border-top: 1px solid #eee;
  }
  .product-reviews__header {
    text-align: center;
    margin-bottom: 3rem;
  }
  .product-reviews__title {
    font-size: 2rem;
    margin: 0 0 1.5rem;
  }
  .product-reviews__summary {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .product-reviews__stars {
    display: flex;
    gap: 0.25rem;
  }
  .product-reviews__rating {
    font-weight: 600;
    font-size: 1.1rem;
  }
  .product-reviews__count {
    color: #595959 !important;
    font-size: 0.9rem;
  }
  .product-reviews__highlights {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    margin-bottom: 3rem;
    padding: 2rem;
    background: #f8f8f8;
    border-radius: 12px;
  }
  @media (max-width: 749px) {
    .product-reviews__highlights {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
  }
  .review-highlight {
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  .review-highlight__icon {
    flex-shrink: 0;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border-radius: 50%;
  }
  .review-highlight__content {
    display: flex;
    flex-direction: column;
  }
  .review-highlight__stat {
    font-size: 1.4rem;
    font-weight: 700;
    color: #1a1a1a;
  }
  .review-highlight__label {
    font-size: 0.9rem;
    color: #4a4a4a !important;
  }
  .product-reviews__testimonials {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
  }
  @media (max-width: 989px) {
    .product-reviews__testimonials {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  @media (max-width: 599px) {
    .product-reviews__testimonials {
      grid-template-columns: 1fr;
    }
  }
  .review-card {
    background: white;
    border: 1px solid #eee;
    border-radius: 12px;
    padding: 1.5rem;
  }
  .review-card__stars {
    display: flex;
    gap: 0.15rem;
    margin-bottom: 1rem;
  }
  .review-card__text {
    font-size: 1rem;
    line-height: 1.6;
    color: #333;
    margin: 0 0 1rem;
    font-style: italic;
  }
  .review-card__author {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  .review-card__name {
    font-weight: 600;
    font-size: 0.9rem;
  }
  .review-card__verified {
    font-size: 0.8rem;
    color: #2e7d32;
    background: rgba(46,125,50,0.1);
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
  }

  /* Sticky Mobile Add to Cart */
  .product-sticky-cart {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    border-top: 1px solid #eee;
    padding: 1rem 0;
    z-index: 100;
    transform: translateY(100%);
    transition: transform 0.3s ease;
    box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
  }
  .product-sticky-cart.visible {
    transform: translateY(0);
  }
  .product-sticky-cart__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
  }
  .product-sticky-cart__info {
    display: flex;
    flex-direction: column;
  }
  .product-sticky-cart__title {
    font-weight: 600;
    font-size: 0.95rem;
    color: #1a1a1a;
  }
  .product-sticky-cart__price {
    font-size: 1.1rem;
    font-weight: 700;
    color: #1a1a1a;
  }
  .product-sticky-cart__btn {
    padding: 0.875rem 2rem;
    white-space: nowrap;
  }
  @media (min-width: 990px) {
    .product-sticky-cart {
      display: none;
    }
  }
</style>

<script>
  // Quantity buttons
  document.querySelectorAll('.quantity-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const input = btn.parentElement.querySelector('input');
      const currentVal = parseInt(input.value) || 1;

      if (btn.classList.contains('quantity-btn--minus') && currentVal > 1) {
        input.value = currentVal - 1;
      } else if (btn.classList.contains('quantity-btn--plus') && currentVal < 99) {
        input.value = currentVal + 1;
      }
    });
  });

  // Thumbnail gallery & current image tracking
  let currentImageIndex = 0;
  const thumbnails = document.querySelectorAll('.product-gallery__thumbnail');
  const imageUrls = Array.from(thumbnails).map(t => t.dataset.imageUrl);

  document.querySelectorAll('.product-gallery__thumbnail').forEach((thumb, index) => {
    thumb.addEventListener('click', () => {
      const mainImage = document.getElementById('product-main-image');
      mainImage.src = thumb.dataset.imageUrl;
      currentImageIndex = index;

      document.querySelectorAll('.product-gallery__thumbnail').forEach(t => t.classList.remove('active'));
      thumb.classList.add('active');
    });
  });

  // Image Zoom Modal
  const zoomModal = document.getElementById('product-zoom-modal');
  const zoomImage = document.getElementById('zoom-image');
  const zoomTrigger = document.querySelector('[data-zoom-trigger]');

  if (zoomTrigger && zoomModal) {
    zoomTrigger.addEventListener('click', () => {
      const mainImage = document.getElementById('product-main-image');
      zoomImage.src = mainImage.src.replace('width=800', 'width=1600');
      zoomModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    });

    zoomModal.querySelector('.product-zoom-modal__close').addEventListener('click', closeZoomModal);
    zoomModal.addEventListener('click', (e) => {
      if (e.target === zoomModal) closeZoomModal();
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (!zoomModal.classList.contains('active')) return;
      if (e.key === 'Escape') closeZoomModal();
      if (e.key === 'ArrowLeft') navigateZoom(-1);
      if (e.key === 'ArrowRight') navigateZoom(1);
    });

    // Nav buttons
    zoomModal.querySelector('.product-zoom-modal__prev').addEventListener('click', () => navigateZoom(-1));
    zoomModal.querySelector('.product-zoom-modal__next').addEventListener('click', () => navigateZoom(1));
  }

  function closeZoomModal() {
    zoomModal.classList.remove('active');
    document.body.style.overflow = '';
  }

  function navigateZoom(direction) {
    if (imageUrls.length === 0) return;
    currentImageIndex = (currentImageIndex + direction + imageUrls.length) % imageUrls.length;
    zoomImage.src = imageUrls[currentImageIndex].replace('width=800', 'width=1600');

    // Update thumbnail selection
    thumbnails.forEach((t, i) => {
      t.classList.toggle('active', i === currentImageIndex);
    });
    document.getElementById('product-main-image').src = imageUrls[currentImageIndex];
  }

  // Copy link functionality
  document.querySelectorAll('[data-copy-url]').forEach(btn => {
    btn.addEventListener('click', async () => {
      const url = btn.dataset.copyUrl;
      try {
        await navigator.clipboard.writeText(url);
        btn.classList.add('copied');
        setTimeout(() => btn.classList.remove('copied'), 2000);
      } catch (err) {
        // Fallback for older browsers
        const input = document.createElement('input');
        input.value = url;
        document.body.appendChild(input);
        input.select();
        document.execCommand('copy');
        document.body.removeChild(input);
        btn.classList.add('copied');
        setTimeout(() => btn.classList.remove('copied'), 2000);
      }
    });
  });

  // Sticky Add to Cart on Mobile
  const stickyCart = document.getElementById('product-sticky-cart');
  const productForm = document.querySelector('.product-form');

  if (stickyCart && productForm) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            stickyCart.classList.remove('visible');
          } else {
            stickyCart.classList.add('visible');
          }
        });
      },
      { threshold: 0, rootMargin: '-100px 0px 0px 0px' }
    );

    observer.observe(productForm);

    // Sticky cart add to cart action
    stickyCart.querySelector('[data-sticky-add-to-cart]').addEventListener('click', () => {
      const submitBtn = productForm.querySelector('.product-form__submit');
      if (submitBtn) submitBtn.click();
    });
  }
</script>

{% schema %}
{
  "name": "Product Main",
  "tag": "section",
  "class": "section-product-main",
  "settings": [
    {
      "type": "header",
      "content": "Social & Reviews"
    },
    {
      "type": "checkbox",
      "id": "show_social_sharing",
      "label": "Show Social Sharing Buttons",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_reviews",
      "label": "Show Customer Reviews Section",
      "default": true
    },
    {
      "type": "header",
      "content": "Personalization"
    },
    {
      "type": "checkbox",
      "id": "enable_personalization",
      "label": "Enable Personalization Form",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "price_includes_personalization",
      "label": "Show 'Personalization Included' Badge",
      "default": true
    },
    {
      "type": "header",
      "content": "Bulk Orders"
    },
    {
      "type": "checkbox",
      "id": "show_bulk_cta",
      "label": "Show Bulk Order CTA",
      "default": true
    },
    {
      "type": "header",
      "content": "Product Information"
    },
    {
      "type": "richtext",
      "id": "materials_info",
      "label": "Materials & Specs",
      "default": "<p><strong>Material:</strong> Natural slate stone</p><p><strong>Dimensions:</strong> 4\" x 4\" x 0.25\"</p><p><strong>Weight:</strong> Approx. 0.5 lb per coaster</p><p><strong>Finish:</strong> Natural edge with foam backing</p>"
    },
    {
      "type": "richtext",
      "id": "care_info",
      "label": "Care Instructions",
      "default": "<p>Wipe clean with a damp cloth. Do not submerge in water or place in dishwasher. Avoid harsh chemicals. For best results, use coasters on flat surfaces.</p>"
    },
    {
      "type": "text",
      "id": "shipping_estimate",
      "label": "Shipping Estimate Text",
      "default": "Ships in 5-7 days"
    },
    {
      "type": "text",
      "id": "processing_time",
      "label": "Processing Time",
      "default": "3-5 business days"
    }
  ]
}
{% endschema %}
